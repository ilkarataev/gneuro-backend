# Документация проекта gneuro-api-bot (backend)

## Описание
Проект представляет собой backend-часть MVP сервиса, реализованного на Node.js с использованием TypeScript. Основная задача — обработка запросов, связанных с ценами, балансом, обработкой и увеличением фотографий, а также интеграция с внешними сервисами.

## Основные возможности

- **Реставрация фотографий** — восстановление старых и поврежденных изображений
- **Увеличение изображений** — повышение разрешения фотографий с помощью ИИ (Freepik API)
- **Система балансов** — управление финансами пользователей и тарификация услуг
- **Интеграция с Telegram** — авторизация через Telegram Mini Apps
- **Система ценообразования** — динамические цены в зависимости от сложности задач

## API Endpoints

### Увеличение изображений
- `GET /api/upscale/price` — получение цены за увеличение
- `POST /api/upscale/upscale` — запуск процесса увеличения
- `GET /api/upscale/status/:taskId` — проверка статуса задачи
- `GET /api/upscale/download` — скачивание результата
- `GET /api/upscale/history/:userId` — история операций пользователя

### Другие API
- `GET /api/prices` — получение всех цен
- `POST /api/webhook` — вебхуки для обработки платежей
- `POST /api/auth/telegram` — авторизация через Telegram

## Структура проекта

- `src/` — исходный код на TypeScript (сервер, роуты, сервисы, модели, миграции)
- `services/` — JS-реализации сервисов (для совместимости или legacy)
- `docker/` — конфигурация для контейнеризации (Dockerfile, настройки cron, MySQL)
- `uploads/` — директория для хранения загружаемых пользователями файлов (фотографий и результатов обработки)
- `temp/` — временные файлы, документация, скрипты для тестирования

### Ключевые компоненты

- `ImageUpscaleService` — сервис для работы с Freepik API
- `PriceService` — управление ценами и тарификацией
- `BalanceService` — управление балансом пользователей
- `PhotoRestorationService` — реставрация фотографий

## Особенности хранения файлов

Папка `uploads` используется для хранения пользовательских файлов и результатов обработки. Это временное решение, обусловленное тем, что проект находится на стадии MVP — мы тестируем рабочую гипотезу. В случае успешного развития и появления финансирования, система хранения будет переписана на более надёжную и масштабируемую (например, облачное хранилище).

## Настройка окружения

Скопируйте `.env.example` в `.env` и настройте переменные:

```bash
cp .env.example .env
```

Основные переменные:
- `DATABASE_*` — настройки MySQL
- `BOT_TOKEN` — токен Telegram бота
- `FREEPIK_API_KEY` — ключ API Freepik для увеличения изображений
- `FREEPIK_API_URL` — URL API Freepik

## Запуск

### С Docker Compose (рекомендуемый)
```bash
docker-compose up -d
```

### Локальная разработка
```bash
npm install
npm run build
npm start
```

Основные сервисы: Node.js backend, MySQL база данных, cron-задачи для резервного копирования.

## Контакты

Вопросы и предложения — к владельцу репозитория.
]