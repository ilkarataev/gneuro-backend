# Добавление новых поэтов в систему

## Обзор

Система стилизации с поэтами позволяет пользователям создавать совместные селфи с известными русскими поэтами. Для добавления нового поэта необходимо выполнить несколько шагов.

## Структура данных поэта

Каждый поэт в системе имеет следующие характеристики:

- **id** - уникальный идентификатор (автоинкремент)
- **name** - короткое имя поэта (например, "Есенин")
- **full_name** - полное имя поэта (например, "Сергей Александрович Есенин")
- **description** - описание поэта (опционально)
- **image_path** - путь к изображению поэта в папке `uploads/poets/`
- **era** - эпоха поэта (опционально, например, "Серебряный век")
- **is_active** - активен ли поэт в системе (по умолчанию true)
- **created_at** - дата создания записи
- **updated_at** - дата последнего обновления

## Пошаговая инструкция

### 1. Подготовка изображения поэта

1. Найдите качественное изображение поэта (рекомендуется портрет)
2. Оптимизируйте изображение:
   - Формат: PNG или JPG
   - Размер: рекомендуется 400x400px или больше
   - Качество: высокое разрешение для лучшего результата
3. Сохраните изображение в папку `images/poets/` с именем в формате `{ИмяПоэта}.png`
   - Пример: `Pushkin.png`, `Lermontov.png`

### 2. Добавление данных в базу данных

#### Вариант A: Через миграцию (рекомендуется)

1. Создайте новый файл миграции в папке `src/migrations/`:
   ```bash
   # Пример имени файла: 20250115_add_pushkin_poet.ts
   ```

2. Содержимое миграции:
   ```typescript
   import { QueryInterface } from 'sequelize';

   export const up = async (queryInterface: QueryInterface): Promise<void> => {
     await queryInterface.bulkInsert('poets', [
       {
         name: 'Пушкин',
         full_name: 'Александр Сергеевич Пушкин',
         description: 'Великий русский поэт, драматург и прозаик, заложивший основы русского реалистического направления',
         image_path: 'poets/Pushkin.png',
         era: 'Золотой век',
         is_active: true,
         created_at: new Date(),
         updated_at: new Date(),
       }
     ]);
   };

   export const down = async (queryInterface: QueryInterface): Promise<void> => {
     await queryInterface.bulkDelete('poets', {
       name: 'Пушкин'
     }, {});
   };
   ```

3. Добавьте вызов миграции в `src/migrate.ts`:
   ```typescript
   import { addPushkinPoet } from './migrations/20250115_add_pushkin_poet';
   
   // В функции runMigrations добавьте:
   try {
     console.log('Начало добавления поэта Пушкина...');
     await addPushkinPoet.up(sequelize.getQueryInterface());
     console.log('Поэт Пушкин добавлен!');
   } catch (error) {
     console.error('Ошибка при добавлении поэта Пушкина:', error);
   }
   ```

#### Вариант B: Прямое добавление в базу данных

```sql
INSERT INTO poets (name, full_name, description, image_path, era, is_active, created_at, updated_at) 
VALUES (
  'Пушкин',
  'Александр Сергеевич Пушкин', 
  'Великий русский поэт, драматург и прозаик',
  'poets/Pushkin.png',
  'Золотой век',
  true,
  NOW(),
  NOW()
);
```

### 3. Запуск миграций

```bash
# Пересоздание базы данных с новыми данными
./recreate_db.sh

# Или только миграции
npm run migrate
```

### 4. Проверка работы

1. Запустите сервер:
   ```bash
   npm run dev
   ```

2. Проверьте API эндпоинт:
   ```bash
   curl http://localhost:3001/api/photos/poets
   ```

3. Убедитесь, что новый поэт отображается в интерфейсе

## Требования к изображениям

### Технические характеристики
- **Формат**: PNG или JPG
- **Размер**: минимум 200x200px, рекомендуется 400x400px
- **Качество**: высокое разрешение для лучшего результата AI
- **Стиль**: портретное фото, желательно в анфас

### Рекомендации по выбору изображения
- Четкое лицо поэта
- Хорошее освещение
- Минимальный фон или нейтральный фон
- Избегайте групповых фотографий
- Предпочтительно исторические портреты

## Структура файлов

```
backend/
├── images/poets/           # Исходные изображения поэтов
│   ├── Esenin.png
│   ├── Fet.png
│   └── Pushkin.png         # Новый поэт
├── uploads/poets/          # Копии изображений (создаются автоматически)
│   ├── Esenin.png
│   ├── Fet.png
│   └── Pushkin.png
└── src/
    ├── migrations/         # Миграции базы данных
    └── services/
        └── ImageCopyService.ts  # Сервис копирования изображений
```

## Автоматическое копирование изображений

Система автоматически копирует изображения из папки `images/poets/` в `uploads/poets/` при запуске сервера. Это обеспечивает:

- Изображения не хранятся в репозитории в папке `uploads/`
- Автоматическое обновление при добавлении новых поэтов
- Проверка существования файлов перед использованием

## API эндпоинты

### Получение списка поэтов
```http
GET /api/photos/poets
```

**Ответ:**
```json
{
  "success": true,
  "poets": [
    {
      "id": 1,
      "name": "Есенин",
      "full_name": "Сергей Александрович Есенин",
      "description": "Русский поэт, представитель новокрестьянской поэзии",
      "image_path": "poets/Esenin.png",
      "era": "Серебряный век",
      "is_active": true
    }
  ]
}
```

### Получение стоимости стилизации
```http
GET /api/photos/poet-style-cost
```

### Создание селфи с поэтом
```http
POST /api/photos/poet-style
Content-Type: multipart/form-data

{
  "poetId": 1,
  "image": [файл изображения]
}
```

## Устранение неполадок

### Поэт не отображается в списке
1. Проверьте, что `is_active = true` в базе данных
2. Убедитесь, что изображение существует в папке `uploads/poets/`
3. Проверьте логи сервера на ошибки

### Ошибка загрузки изображения
1. Проверьте права доступа к файлу
2. Убедитесь, что файл не поврежден
3. Проверьте формат файла (PNG/JPG)

### Ошибка в API
1. Проверьте подключение к базе данных
2. Убедитесь, что миграции выполнены успешно
3. Проверьте логи сервера

## Примеры известных русских поэтов

### Золотой век
- Александр Сергеевич Пушкин
- Михаил Юрьевич Лермонтов
- Фёдор Иванович Тютчев

### Серебряный век
- Сергей Александрович Есенин
- Афанасий Афанасьевич Фет
- Александр Александрович Блок
- Анна Андреевна Ахматова
- Марина Ивановна Цветаева

### Советский период
- Владимир Владимирович Маяковский
- Борис Леонидович Пастернак
- Иосиф Александрович Бродский

## Заключение

Добавление нового поэта в систему - простой процесс, который включает подготовку изображения, добавление данных в базу и проверку работы. Система автоматически обрабатывает копирование файлов и предоставляет API для работы с поэтами.

Для получения дополнительной помощи обращайтесь к разработчикам или проверяйте логи системы.
