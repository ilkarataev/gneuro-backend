# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π

## –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É backend
cd backend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate
```

## –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞–∫–µ—Ç—ã:

- Sequelize –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

## –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### queue_jobs
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–¥–∞—á–∏
- `job_type` - –¢–∏–ø –∑–∞–¥–∞—á–∏ (image_generation, photo_restoration, etc.)
- `payload` - JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∏
- `status` - –°—Ç–∞—Ç—É—Å: pending, processing, completed, failed, retrying
- `retry_count` - –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- `max_retries` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `next_retry_at` - –í—Ä–µ–º—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏
- `started_at` - –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `completed_at` - –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- `error_message` - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- `created_at`, `updated_at` - –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### photos
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å `queued` –≤ ENUM

### api_requests
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å `queued` –≤ ENUM

## –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π
```
GET /api/queue/stats
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```json
{
  "success": true,
  "stats": {
    "pending": 0,
    "processing": 2,
    "completed": 45,
    "failed": 1,
    "retrying": 0,
    "activeJobs": 2
  }
}
```

### –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –ø–æ ID —Ñ–æ—Ç–æ
```
GET /api/photos/:photoId/status
```

### –í—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
GET /api/users/:userId/jobs?limit=10
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `src/config/queue.ts`:

- `MAX_RETRIES` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (5)
- `RETRY_DELAYS` - –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- `CONCURRENT_JOBS` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–¥–∞—á (3)
- `QUEUE_CHECK_INTERVAL` - –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—á–µ—Ä–µ–¥–∏ (5 —Å–µ–∫)

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏:

1. **–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** ‚Üí –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
2. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç** —Å `photo_id` –∏ `job_id`
3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `/api/photos/:photoId/status`
4. **–ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ** ‚Üí —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `completed` –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è `processed_image_url`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **Production**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Development**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã**: –ü—Ä–∏ —Å–±–æ—è—Ö –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –¥–æ 5 —Ä–∞–∑

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π –ø–æ–º–µ—á–µ–Ω—ã –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `üìã [QUEUE]` - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ—á–µ—Ä–µ–¥—è–º–∏
- `üîß [JOB_PROCESSOR]` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á
- `‚ùå [ERROR_HANDLER]` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (NODE_ENV=production) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
> "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ—Ä–≤–µ—Ä –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –í–∞—à–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–∑–∂–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏."

–†–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
